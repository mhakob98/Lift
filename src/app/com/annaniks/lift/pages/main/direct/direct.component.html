<div class="pg-container direct">
    <div class="pg-content">
        <div class="header d-flex justify-content-between">
            <p class="pg-title text-left">Управление сообщениями в директ</p>
            <a class="settings cursor-pointer">
                <span class="text-left">Настройки рекламной рассылки</span>
                <img class="icon" src="/assets/icons/settings-icon.png">
            </a>
        </div>
        <div class="messaging">
            <div class="inbox_msg">
                <div class="inbox_people">
                    <div (clickOutside)="onClickedOutside()"
                        class="d-flex justify-content-between message-remark position-relative">
                        <button class="new-message" (click)="createChatOpened = !createChatOpened">
                            Новое сообщение
                            <img src="assets/icons/message.png" alt="">
                        </button>
                        <button class="new-bookmark" (click)="setActiveTab(4)">
                            Новая рассылка
                            <img src="assets/icons/email.png" alt="">
                        </button>
                        <div class="new-message-dropDown position-absolute" [ngClass]="{'d-block':createChatOpened}">
                            <app-create-chat [(allChats)]="allChats" (activeChatChange)="setActiveChat($event)"
                                [(activeChat)]="activeChat" [(createChatOpened)]="createChatOpened"></app-create-chat>
                        </div>
                    </div>
                    <div class="headind_srch d-flex">
                        <div class="search-tab-item" [class.active]="activeTab==1" (click)="setActiveTab(1)">
                            <p>ЛС</p>
                        </div>
                        <div class="search-tab-item" [class.active]="activeTab==2" (click)="setActiveTab(2)">
                            <p>Разослано</p>
                        </div>
                        <div class="search-tab-item" [class.active]="activeTab==3" (click)="setActiveTab(3)">
                            <p>Запланировано</p>
                        </div>
                    </div>
                    <div class="inbox_chat" ngxInfiniteScroller initialScrollPosition="TOP" strategy="scrollingToBottom"
                        (onScrollDown)="moreInbox()">
                        <div class="inbox_chat_tab" *ngIf="activeTab==1">
                            <div class="chat_list" (click)="setActiveChat(item)"
                                *ngFor="let item of allChats;let ind = index"
                                [ngClass]="{'active_chat':activeChat.thread_id == allChats[ind].thread_id}">
                                <div class="chat_people">

                                    <div class="chat_img">
                                        <img *ngIf="!item.is_group" [src]="item.users[0].profile_pic_url" alt="sunil">
                                        <div *ngIf="item.is_group" class="chat_img_multiple">
                                            <img [src]="item.users[0].profile_pic_url">
                                            <img [src]="item.users[1].profile_pic_url">
                                        </div>

                                    </div>
                                    <div class="chat_ib">
                                        <p>{{item.thread_title}}</p>
                                    </div>
                                    <div *ngIf="item.read_state != 0" class="chat-count">

                                    </div>
                                </div>
                            </div>
                            <div *ngIf="loading" class="loading">
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                                <div class="thread_loading">
                                    <div></div>
                                    <span></span>
                                </div>
                            </div>
                            <div *ngIf="allChats.length == 0 && !loading" class="no-chat">
                                <p class="empty-message">У вас пока нет сообщений</p>
                            </div>
                        </div>
                        <div *ngIf="activeTab==2">
                            <div class="chat_list" *ngFor="let item of oldMailings;let ind = index">
                                <div class="chat_people">

                                    <div class="chat_img">
                                        <img *ngIf="!item.is_group" [src]="item?.users[0].profile_pic_url" alt="sunil">
                                        <div *ngIf="item.is_group" class="chat_img_multiple">
                                        </div>
                                        <div class="chat_ib">
                                            <!-- <p>{{item.thread_title}}</p> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="activeTab==3">
                                <div class="chat_list" *ngFor="let item of newMailings;let ind = index">
                                    <div class="chat_people">
                                        <div class="chat_img">
                                            <img *ngIf="!item.is_group" [src]="item.users[0].profile_pic_url"
                                                alt="sunil">
                                        </div>
                                        <div class="chat_ib">
                                            <p></p>
                                        </div>
                                        <!-- <div *ngIf="item.read_state != 0" class="chat-count">

                                        </div> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mesgs">
                        <div class="mesgs_tab" *ngIf="activeTab==1">
                            <div *ngIf="loading">
                                <app-message-item mode="skeletion" [isIncoming]="true">
                                </app-message-item>
                                <app-message-item mode="skeletion" [isIncoming]="false">
                                </app-message-item>
                                <app-message-item mode="skeletion" [isIncoming]="true">
                                </app-message-item>
                                <app-message-item mode="skeletion" [isIncoming]="false">
                                </app-message-item>
                                <app-message-item mode="skeletion" [isIncoming]="true">
                                </app-message-item>
                                <app-message-item mode="skeletion" [isIncoming]="false">
                                </app-message-item>
                            </div>
                            <div *ngIf="!loading">
                                <div id="aaaa" initialScrollPosition="BOTTOM" strategy="scrollingToTop"
                                    ngxInfiniteScroller (onScrollUp)="onScrolledUp()" *ngIf="allChats?.length > 0"
                                    class="msg_history">
                                    <app-message-item [previousMessage]="ind > 0 ? activeChatMessages[ind - 1] : null "
                                        [isIncoming]="getPhotoByUserIdAndCheckIfIncoming(message.user_id).isIncoming"
                                        [senderPhoto]="getPhotoByUserIdAndCheckIfIncoming(message.user_id).picture"
                                        [message]="message" *ngFor="let message of activeChatMessages;let ind = index">
                                    </app-message-item>
                                    <div *ngIf="activeChatMessages.length == 0" class="no-chat">
                                        <p class="text-center empty-message">У вас пока нет сообщений</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mesgs_tab" *ngIf="activeTab==4">
                            <app-direct-schedule></app-direct-schedule>
                        </div>
                        <div class="mesgs_tab" *ngIf="activeTab==3 || activeTab==2">
                            <app-direct-sent></app-direct-sent>
                        </div>
                        <form [formGroup]="messageForm"
                            class="type_msg d-flex w-100 justify-content-between align-items-baseline">
                            <div class="image-upload">
                                <label for="file-input">
                                    <img height="20" src="assets/icons/attachment.png" />
                                </label>
                                <input (change)="handleInputChange($event)" class="file" id="file-input" type="file" />
                            </div>
                            <div class="input_msg_write d-flex  align-items-center">

                                <input formControlName="message" type="text" class="write_msg"
                                    placeholder="Введите сообщение" />
                                <div class="image-upload">
                                    <label for="file-input">
                                        <img src="assets/icons/gallery.png" />
                                    </label>
                                    <input (change)="handleInputChange($event)" class="file" id="file-input"
                                        type="file" />
                                </div>
                                <!-- <button class="chat-actions" type="button"><img src="assets/icons/smole.png"
                                    alt=""></button> -->
                            </div>
                            <button [disabled]="messageForm.invalid" (click)="sendMessage()" class="msg_send_btn"
                                type="submit"><img src="assets/icons/send-chat.png" alt=""></button>
                        </form>
                    </div>

                </div>

            </div>
        </div>
    </div>